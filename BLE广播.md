# 蓝牙协议 - BLE广播 #
----------
* 介绍
* Advertising interval（广播间隔）
* 





## 介绍 ##
低功耗蓝牙设备通过广播信道发现其他设备，一个设备进行广播，而另一个设备进行扫描。当从机处于广播态时才能被主机发现，广播包会在37/38/39三个信道上依次广播。

## Advertising interval（广播间隔） ##
设备每次广播时，会在3个广播信道上发送相同的报文，这些报文被称为一个广播事件。除了定向广播以外，其他广播事件均可以选择20ms~10.28s不等间隔。通常，一个广播中的设备会每一秒广播一次。两个相邻广播事件之间的时间称为广播间隔。

但是，设备周期性的发送广播会有一个问题：由于设备间的时钟会不同程度的漂移，两个设备可能在很长一段时间同时广播而造成干扰。为了防止这一情况的发生，除定向广播之外的其他广播类型，发送时间均会被扰动。实现该扰动的方式为，在上一次广播事件后加入0~10ms的随机延时。这意味着，即使两个设备广播间隔相同，并在相同信道及时间点上发送造成了冲突，但它们发送下一个广播事件时也会有很大可能不再冲突。

所以相邻两个广播事件之间的事件间隔为：T_AdvEvent = advInterval + advDelay

其中，advInterval必须是0.625ms的整数倍，范围是20~10.24s之间。对于可扫描非定向广播和不可连接非定向广播这两种广播类型，该值最好不小于100ms（即16个0.625ms）。advDelay是Link Layer（链路层）分配的一个伪随机数，它的范围是0~10ms。
![](https://img-blog.csdn.net/20160415232643607)

蓝牙4.x，广播有效载荷最多是31个字节。而在蓝牙5.0中，通过添加额外的广播信道和新的广播PDU，将有效载荷增加到了255个字节

当然，实际设置过程中没有广播间隔参数，而是设置Advertising_Interval_Min（最小广播间隔）和Advertising_Interval_Max（最大广播间隔）这两个参数来调整广播间隔。如果要固定广播间隔为某一个值，只需要将这两个参数设置为同一个有效数值即可。

## Advertising_Type（广播类型） ##

![](https://img-blog.csdn.net/201806151358060?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p3YzE3MjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70 "广播报文类型")

1. 可连接的非定向广播：Connectable Undirected Event Type（ADV_IND），这是一种用途最广的广播类型，包括广播数据和扫描响应数据，它表示当前设备可以接受其他任何设备的连接请求。
2. 
